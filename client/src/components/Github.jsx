import React, { useEffect, useState } from "react";

import { useNavigate } from "react-router-dom";
import { useSelector } from "react-redux";

const Github = ({ fetchGithubktoken }) => {
  const navigate = useNavigate();
  const urlParams = new URLSearchParams(window.location.search);
  const user = useSelector((state) => state.user.value);
  const [isdisable, setIsdisable] = useState(false);

  const handleGithubLogin = () => {
    window.location.href = `${process.env.REACT_APP_BACKEND_URL}/githublogin`;
  };

  const buttonStatus = async () => {
    const response = await fetch(
      `${process.env.REACT_APP_BACKEND_URL}/checkgithubtoken?user_id=${user?.id}&source_type=github`
    );

    const data = await response.json();
    if (data === true) {
      setIsdisable(data);
    }
  };

  useEffect(() => {
    buttonStatus();
  }, []);

  useEffect(() => {
    if (urlParams.has("code") && urlParams.get("service") == "github") {
      fetchGithubktoken();
      navigate("/home");
      setTimeout(buttonStatus, 3000);
    }
  }, [window.location.search]);

  return (
    <div class="mx-auto mt-10 max-w-sm">
      <div class="rounded-lg bg-white p-6 shadow-lg">
        <div class="flex items-center space-x-4">
          <svg
            height="150"
            viewBox="0 0 176 176"
            width="150"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g id="Layer_2" data-name="Layer 2">
              <g id="github">
                <rect
                  id="background"
                  fill="#262626"
                  height="176"
                  rx="24"
                  width="176"
                />
                <path
                  id="background-2"
                  d="m88 35.29c-30.39 0-55 24.2-55 54.05 0 23.88 15.76 44.14 37.61 51.28 2.75.5 3.75-1.17 3.75-2.6s0-4.69-.06-9.19c-15.3 3.26-18.53-7.25-18.53-7.25-2.5-6.24-6.12-7.91-6.12-7.91-5-3.35.39-3.28.39-3.28 5.52.37 8.42 5.57 8.42 5.57 4.9 8.26 12.87 5.87 16 4.49a11.42 11.42 0 0 1 3.54-7.22c-12.21-1.36-25-6-25-26.71a20.64 20.64 0 0 1 5.57-14.52c-.62-1.37-2.47-6.86.48-14.31 0 0 4.61-1.45 15.13 5.54a52.85 52.85 0 0 1 27.5 0c10.45-7 15-5.54 15-5.54 3 7.45 1.1 12.94.55 14.31a20.71 20.71 0 0 1 5.64 14.5c0 20.76-12.86 25.33-25.09 26.66 1.92 1.62 3.71 4.94 3.71 10 0 7.23-.07 13-.07 14.8 0 1.42 1 3.11 3.78 2.57 22-7.1 37.75-27.37 37.75-51.21.05-29.83-24.58-54.03-54.95-54.03z"
                  fill="#fff"
                  data-name="background"
                />
              </g>
            </g>
          </svg>

          <div>
            <h3 class="text-lg font-bold">Github</h3>
            <p class="text-gray-600">
              Connect GitHub to LocalAssistant, making it simple to interact
              with commits, PRs, and issues via chat commands.
            </p>
          </div>
        </div>
        <div class="flex content-center justify-start align-middle">
          <button
            disabled={isdisable}
            onClick={handleGithubLogin}
            class="mt-4 flex items-center justify-center gap-x-2 rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700"
            style={{
              backgroundColor: isdisable ? "#9CA3AF" : "rgb(59 130 246)",
            }}
          >
            <p>Connect</p>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              height="30"
              version="1.1"
              viewBox="0 0 512 512"
              width="30"
            >
              <g id="surface1">
                <path d="M 280.5 204 C 280.5 208.140625 283.859375 211.5 288 211.5 L 300.5 211.5 L 300.5 300.5 L 211.5 300.5 L 211.5 211.5 L 256 211.5 C 260.140625 211.5 263.5 208.140625 263.5 204 C 263.5 199.859375 260.140625 196.5 256 196.5 L 208 196.5 C 201.660156 196.5 196.5 201.660156 196.5 208 L 196.5 304 C 196.5 310.339844 201.660156 315.5 208 315.5 L 304 315.5 C 310.339844 315.5 315.5 310.339844 315.5 304 L 315.5 208 C 315.5 201.660156 310.339844 196.5 304 196.5 L 288 196.5 C 283.859375 196.5 280.5 199.859375 280.5 204 Z M 280.5 204 " />
                <path d="M 41.5 30 C 35.160156 30 30 35.160156 30 41.5 L 30 93.5 C 30 99.839844 35.160156 105 41.5 105 L 93.5 105 C 99.839844 105 105 99.839844 105 93.5 L 105 41.5 C 105 35.160156 99.839844 30 93.5 30 Z M 90 90 L 45 90 L 45 45 L 90 45 Z M 90 90 " />
                <path d="M 93.5 407 L 41.5 407 C 35.160156 407 30 412.160156 30 418.5 L 30 470.5 C 30 476.839844 35.160156 482 41.5 482 L 93.5 482 C 99.839844 482 105 476.839844 105 470.5 L 105 418.5 C 105 412.160156 99.839844 407 93.5 407 Z M 90 467 L 45 467 L 45 422 L 90 422 Z M 90 467 " />
                <path d="M 396.5 135 L 492.5 135 C 503.253906 135 512 126.253906 512 115.5 L 512 19.5 C 512 8.746094 503.253906 0 492.5 0 L 396.5 0 C 385.746094 0 377 8.746094 377 19.5 L 377 60 L 287 60 C 282.859375 60 279.5 63.359375 279.5 67.5 L 279.5 166.5 L 238.5 166.5 L 238.5 137.210938 C 247.230469 134.113281 253.5 125.777344 253.5 116 C 253.5 103.59375 243.40625 93.5 231 93.5 C 218.59375 93.5 208.5 103.59375 208.5 116 C 208.5 125.777344 214.769531 134.113281 223.5 137.210938 L 223.5 166.5 L 189.992188 166.5 C 177.039062 166.5 166.5 177.039062 166.5 189.992188 L 166.5 233.5 L 75 233.5 L 75 135 L 115.5 135 C 126.253906 135 135 126.253906 135 115.5 L 135 96 C 135 91.859375 131.640625 88.5 127.5 88.5 C 123.359375 88.5 120 91.859375 120 96 L 120 115.5 C 120 117.980469 117.980469 120 115.5 120 L 19.5 120 C 17.019531 120 15 117.980469 15 115.5 L 15 19.5 C 15 17.019531 17.019531 15 19.5 15 L 115.5 15 C 117.980469 15 120 17.019531 120 19.5 L 120 64 C 120 68.140625 123.359375 71.5 127.5 71.5 C 131.640625 71.5 135 68.140625 135 64 L 135 19.5 C 135 8.746094 126.253906 0 115.5 0 L 19.5 0 C 8.746094 0 0 8.746094 0 19.5 L 0 115.5 C 0 126.253906 8.746094 135 19.5 135 L 60 135 L 60 241 C 60 245.140625 63.359375 248.5 67.5 248.5 L 166.5 248.5 L 166.5 280.5 L 156.210938 280.5 C 153.113281 271.769531 144.777344 265.5 135 265.5 C 122.59375 265.5 112.5 275.59375 112.5 288 C 112.5 300.40625 122.59375 310.5 135 310.5 C 144.777344 310.5 153.113281 304.230469 156.210938 295.5 L 166.5 295.5 L 166.5 322.007812 C 166.5 334.960938 177.039062 345.5 189.992188 345.5 L 223.5 345.5 L 223.5 434.585938 L 135 434.585938 L 135 396.5 C 135 385.746094 126.253906 377 115.5 377 L 19.5 377 C 8.746094 377 0 385.746094 0 396.5 L 0 492.5 C 0 503.253906 8.746094 512 19.5 512 L 115.5 512 C 126.253906 512 135 503.253906 135 492.5 L 135 449.585938 L 231 449.585938 C 235.140625 449.585938 238.5 446.226562 238.5 442.085938 L 238.5 345.5 L 279.5 345.5 L 279.5 378.789062 C 270.769531 381.886719 264.5 390.222656 264.5 400 C 264.5 412.40625 274.59375 422.5 287 422.5 C 299.40625 422.5 309.5 412.40625 309.5 400 C 309.5 390.222656 303.230469 381.886719 294.5 378.789062 L 294.5 345.5 L 322.007812 345.5 C 334.960938 345.5 345.5 334.960938 345.5 322.007812 L 345.5 270.949219 L 437.011719 270.949219 L 437.011719 377 L 396.5 377 C 385.746094 377 377 385.746094 377 396.5 L 377 416 C 377 420.140625 380.359375 423.5 384.5 423.5 C 388.640625 423.5 392 420.140625 392 416 L 392 396.5 C 392 394.019531 394.019531 392 396.5 392 L 492.5 392 C 494.980469 392 497 394.019531 497 396.5 L 497 492.5 C 497 494.980469 494.980469 497 492.5 497 L 396.5 497 C 394.019531 497 392 494.980469 392 492.5 L 392 447.875 C 392 443.734375 388.640625 440.375 384.5 440.375 C 380.359375 440.375 377 443.734375 377 447.875 L 377 492.5 C 377 503.253906 385.746094 512 396.5 512 L 492.5 512 C 503.253906 512 512 503.253906 512 492.5 L 512 396.5 C 512 385.746094 503.253906 377 492.5 377 L 452.011719 377 L 452.011719 263.449219 C 452.011719 259.308594 448.652344 255.949219 444.511719 255.949219 L 345.5 255.949219 L 345.5 230.5 L 381.238281 230.5 C 384.335938 239.230469 392.671875 245.5 402.449219 245.5 C 414.855469 245.5 424.949219 235.40625 424.949219 223 C 424.949219 210.59375 414.855469 200.5 402.449219 200.5 C 392.671875 200.5 384.335938 206.769531 381.238281 215.5 L 345.5 215.5 L 345.5 189.992188 C 345.5 177.039062 334.960938 166.5 322.007812 166.5 L 294.5 166.5 L 294.5 75 L 377 75 L 377 115.5 C 377 126.253906 385.746094 135 396.5 135 Z M 231 108.5 C 235.136719 108.5 238.5 111.863281 238.5 116 C 238.5 120.136719 235.136719 123.5 231 123.5 C 226.863281 123.5 223.5 120.136719 223.5 116 C 223.5 111.863281 226.863281 108.5 231 108.5 Z M 135 295.5 C 130.863281 295.5 127.5 292.136719 127.5 288 C 127.5 283.863281 130.863281 280.5 135 280.5 C 139.136719 280.5 142.5 283.863281 142.5 288 C 142.5 292.136719 139.136719 295.5 135 295.5 Z M 120 492.5 C 120 494.980469 117.980469 497 115.5 497 L 19.5 497 C 17.019531 497 15 494.980469 15 492.5 L 15 396.5 C 15 394.019531 17.019531 392 19.5 392 L 115.5 392 C 117.980469 392 120 394.019531 120 396.5 Z M 287 407.5 C 282.863281 407.5 279.5 404.136719 279.5 400 C 279.5 395.863281 282.863281 392.5 287 392.5 C 291.136719 392.5 294.5 395.863281 294.5 400 C 294.5 404.136719 291.136719 407.5 287 407.5 Z M 402.449219 215.5 C 406.585938 215.5 409.949219 218.863281 409.949219 223 C 409.949219 227.136719 406.585938 230.5 402.449219 230.5 C 398.3125 230.5 394.949219 227.136719 394.949219 223 C 394.949219 218.863281 398.3125 215.5 402.449219 215.5 Z M 330.5 189.992188 L 330.5 322.007812 C 330.5 326.691406 326.691406 330.5 322.007812 330.5 L 189.992188 330.5 C 185.308594 330.5 181.5 326.691406 181.5 322.007812 L 181.5 189.992188 C 181.5 185.308594 185.308594 181.5 189.992188 181.5 L 322.007812 181.5 C 326.691406 181.5 330.5 185.308594 330.5 189.992188 Z M 396.5 15 L 492.5 15 C 494.980469 15 497 17.019531 497 19.5 L 497 115.5 C 497 117.980469 494.980469 120 492.5 120 L 396.5 120 C 394.019531 120 392 117.980469 392 115.5 L 392 67.695312 C 392.003906 67.628906 392.011719 67.566406 392.011719 67.5 C 392.011719 67.433594 392.003906 67.371094 392 67.304688 L 392 19.5 C 392 17.019531 394.019531 15 396.5 15 Z M 396.5 15 " />
                <path d="M 418.5 105 L 470.5 105 C 476.839844 105 482 99.839844 482 93.5 L 482 41.5 C 482 35.160156 476.839844 30 470.5 30 L 418.5 30 C 412.160156 30 407 35.160156 407 41.5 L 407 93.5 C 407 99.839844 412.160156 105 418.5 105 Z M 422 45 L 467 45 L 467 90 L 422 90 Z M 422 45 " />
                <path d="M 470.5 482 C 476.839844 482 482 476.839844 482 470.5 L 482 418.5 C 482 412.160156 476.839844 407 470.5 407 L 418.5 407 C 412.160156 407 407 412.160156 407 418.5 L 407 470.5 C 407 476.839844 412.160156 482 418.5 482 Z M 422 422 L 467 422 L 467 467 L 422 467 Z M 422 422 " />
              </g>
            </svg>
          </button>
        </div>
      </div>
    </div>
  );
};

export default Github;
